from django.utils import timezonefrom drf_yasg.utils import swagger_auto_schemafrom rest_framework import statusfrom rest_framework.decorators import permission_classes, api_viewfrom rest_framework.generics import get_object_or_404from rest_framework.permissions import IsAuthenticatedfrom rest_framework.response import Responsefrom api.v1.sanatorium.serializers import ProcedureSerializer, ProcedureIllnessHistorySerializerfrom api.v1.sanatorium.serializers.schedule import ListSchedulesOfDoctorSerializerfrom apps.sanatorium.models import ProcedureModel, ProcedureIllnessHistoryModel, ScheduleModel@swagger_auto_schema(tags=['sanatorium'], method="get")@api_view(['GET', ])@permission_classes((IsAuthenticated,))def get_procedures_view(request):    procedures = ProcedureModel.objects.all()    serializers = ProcedureSerializer(procedures, many=True)    return Response(serializers.data)@swagger_auto_schema(tags=['sanatorium'], method="get")@api_view(['GET', ])@permission_classes((IsAuthenticated,))def get_procedure_pk_view(request, pk):    procedure = get_object_or_404(ProcedureModel, pk=pk)    serializers = ProcedureSerializer(procedure)    return Response(serializers.data)@swagger_auto_schema(tags=['sanatorium'], method="delete")@api_view(['DELETE', ])@permission_classes((IsAuthenticated,))def delete_procedure_pk_view(request, pk):    procedure = get_object_or_404(ProcedureModel, pk=pk)    procedure.delete()    return Response(status=204)@swagger_auto_schema(tags=['sanatorium'], method="post", request_body=ProcedureSerializer)@api_view(['POST', ])@permission_classes((IsAuthenticated,))def create_procedure_view(request):    serializer = ProcedureSerializer(data=request.data)    if serializer.is_valid():        serializer.save()        return Response(status=204)    return Response(status=400)@swagger_auto_schema(tags=['sanatorium'], method="get", request_body=ProcedureSerializer)@api_view(['GET', ])@permission_classes((IsAuthenticated,))def get_procedure_illnesses_view(request):    procedures_illnesses = ProcedureIllnessHistoryModel.objects.all()    serializer = ProcedureIllnessHistorySerializer(procedures_illnesses, many=True)    return Response(serializer.data)@swagger_auto_schema(tags=['sanatorium'], method="get", request_body=ProcedureSerializer)@api_view(['GET', ])@permission_classes((IsAuthenticated,))def get_procedure_illness_pk_view(request, pk):    procedures_illness = get_object_or_404(ProcedureIllnessHistoryModel, pk=pk)    serializer = ProcedureIllnessHistorySerializer(procedures_illness)    return Response(serializer.data)# ---------------------# PHYSICIANS PROCEDURES# ---------------------@swagger_auto_schema(tags=['sanatorium'], method="get")@api_view(['GET', ])@permission_classes((IsAuthenticated,))def get_physicians_procedure_view(request):    user = request.user    date_param = request.query_params.get('date')    # Assuming date format is 'YYYY-MM-DD', you may need to adjust it based on your requirements    try:        selected_date = timezone.datetime.strptime(date_param, '%Y-%m-%d').date() if date_param else None    except ValueError:        return Response({'error': 'Invalid date format. Please use YYYY-MM-DD.'}, status=status.HTTP_400_BAD_REQUEST)    procedures = ScheduleModel.objects.filter(procedure_doctor=user, start_time__date=selected_date)    serializers = ListSchedulesOfDoctorSerializer(procedures, many=True)    return Response(serializers.data)# @swagger_auto_schema(tags=['sanatorium'], method="get")# @api_view(['GET', ])# @permission_classes((IsAuthenticated,))# def get_physicians_procedure_view(request, pk):#     procedures = get_object_or_404(pk=pk)#     serializers = ListSchedulesOfDoctorSerializer(procedures)#     return Response(serializers.data)