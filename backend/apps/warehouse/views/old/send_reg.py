from django.contrib.auth.decorators import login_requiredfrom django.shortcuts import get_object_or_404, renderfrom django.shortcuts import redirectfrom apps.account.models import Accountfrom apps.warehouse.forms import AddItemToChequeFormfrom apps.warehouse.models import ItemsModel, SendRegistryModel, StorePointModel, WarehouseChequeModel, \    ChequeItemsModel, SentItemsModel@login_required(login_url="warehouse:warehouse-login")def create_send_reg_view(request):    context = {}    send_reg = SendRegistryModel.objects.create(sender=StorePointModel.objects.all().order_by('?').first(),                                                receiver=StorePointModel.objects.all().order_by('?').first())    context['send_reg'] = send_reg    return redirect("warehouse:warehouse-create-send-reg", send_reg.id)@login_required(login_url="warehouse:warehouse-login")def get_send_reg_view(request, s_pk):    context = {}    send_reg_items_summa = 0    user = request.user    send_reg = get_object_or_404(SendRegistryModel, pk=s_pk)    items = ItemsModel.objects.all()    send_reg_items = SentItemsModel.objects.filter(send_registry=send_reg)    for i in send_reg_items:        send_reg_items_summa += i.quantity * i.item.price    context['send_reg'] = send_reg    context['items'] = items    context['points'] = StorePointModel.objects.all()    context['send_reg_items'] = send_reg_items    context['send_reg_items_summa'] = send_reg_items_summa    return render(request, 'old/warehouse/create-send-reg.html', context)@login_required(login_url="warehouse:warehouse-login")def send_reg_popup_post(request, s_pk):    if request.POST:        form = AddItemToChequeForm(request.POST)        send_reg = get_object_or_404(SendRegistryModel, pk=s_pk)        if form.is_valid():            itemid = request.POST["itemid"]            item = get_object_or_404(ItemsModel, pk=itemid)            quantity = request.POST["quantity"]            send_reg_item = SentItemsModel.objects.filter(send_registry=send_reg, item=item).first()            if send_reg_item:                send_reg_item.quantity = quantity                send_reg_item.save()            else:                SentItemsModel.objects.create(send_registry=send_reg, item=item, quantity=quantity)    return redirect("warehouse:warehouse-create-send-reg", s_pk)@login_required(login_url="warehouse:warehouse-login")def send_reg_popup_insurance_post(request, s_pk):    if request.POST:        send_reg = get_object_or_404(SendRegistryModel, pk=s_pk)        point = request.POST["FIO"]        point = get_object_or_404(StorePointModel, pk=point)        send_reg.receiver = point        send_reg.save()    return redirect("warehouse:warehouse-create-send-reg", s_pk)