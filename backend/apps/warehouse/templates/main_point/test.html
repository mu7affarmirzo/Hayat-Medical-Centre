<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Item Management</title>
<style>
  table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
  }
  th, td {
    padding: 8px;
    text-align: left;
  }
  input[type="number"], input[type="text"], button {
    width: 100%;
    box-sizing: border-box;
  }
  .search-results {
    cursor: pointer;
  }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
$(document).ready(function() {
  $('#searchInput').on('input', function() {
    var searchQuery = $(this).val();
    if (searchQuery.length > 2) {
      $.ajax({
        url: '{% url 'warehouse_v2:mp-item-search' %}?q=',
        data: { 'query': searchQuery },
        success: function(data) {
          $('#searchResults').empty();
          data.forEach(function(item) {
            $('#searchResults').append(
              `<tr class="search-results" data-item="${item.name}" data-company="${item.company}"
                  data-price="${item.price}" data-seria="${item.seria}" data-inpack="${item.in_pack}"
                  data-unit="${item.unit}">
                <td>${item.name}</td>
                <td>${item.company}</td>
                <td>${item.price}</td>
                <td>${item.seria}</td>
                <td>${item.in_pack}</td>
                <td>${item.unit}</td>
              </tr>`
            );
          });
        }
      });
    }

  });

  $(document).on('dblclick', '.search-results', function() {
    var item = $(this).data('item');
    var company = $(this).data('company');
    var price = $(this).data('price');
    var expireDate = new Date().toISOString().slice(0, 10); // Example expire date
    $('#itemsList').append(
      `<tr>
        <td>${item}</td>
        <td><input type="number" value="1" min="1" style="width: 60px;"></td> <!-- Editable quantity -->
        <td><input type="text" value="${price}" style="width: 80px;"></td> <!-- Editable price -->
        <td>${expireDate}</td>
        <td><button type="button" onclick="removeRow(this)">Remove</button></td>
      </tr>`
    );
  });
  window.removeRow = function(button) {
    $(button).closest('tr').remove();
  };
});
</script>
</head>
<body>
<h1>Item Management</h1>
<form method="post" action="{% url 'warehouse_v2:mp-income-register-dynamic' %}">
  {% csrf_token %}
  <h2>Items List</h2>
  <table id="itemsList">
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Expire Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Items will be added here dynamically -->
    </tbody>
  </table>
  <button type="submit">Submit Items</button>
</form>

<h2>Search Items</h2>
<input type="text" id="searchInput" placeholder="Search for items...">
<table>
  <tr>
    <th>Name</th>
    <th>Company</th>
    <th>Price</th>
    <th>Seria</th>
    <th>In Pack</th>
    <th>Unit</th>
  </tr>
  <tbody id="searchResults">
    <!-- Search results will be populated here -->
  </tbody>
</table>

</body>
</html>
